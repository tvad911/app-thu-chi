# Hướng Dẫn Test Ứng Dụng Sổ Thu Chi (V3)

Tài liệu này hướng dẫn cách kiểm thử ứng dụng sau khi cập nhật phiên bản V3 với các tính năng: Bảo mật, Sự kiện, Ngân sách thông minh, Đa tiền tệ, Tìm kiếm nâng cao và Sổ quỹ.

## 1. Automated Tests (Kiểm thử tự động)

Dự án đã bao gồm các Unit Test cho các logic quan trọng.

### Cách chạy test:
Mở terminal tại thư mục dự án và chạy:
```bash
flutter test test/unit/
```

### Các module được test:
1.  **CurrencyUtils** (`test/unit/core/utils/currency_utils_test.dart`):
    -   Định dạng tiền tệ (VND, USD, ...).
    -   Chế độ riêng tư (`Privacy Mode`): ẩn số tiền thành `*****`.
    -   Định dạng rút gọn (1.5M, 10K).

2.  **BudgetAlertService** (`test/unit/services/budget_alert_service_test.dart`):
    -   Kiểm tra logic cảnh báo khi chi tiêu vượt quá 90% ngân sách.
    -   Sử dụng database in-memory để giả lập dữ liệu.

3.  **EventRepository** (`test/unit/repositories/event_repository.dart`):
    -   CRUD sự kiện (Tạo, Xem, Sửa, Xóa).
    -   Tính toán tổng chi tiêu và số giao dịch của sự kiện.

---

## 2. Manual Test Cases (User Acceptance Testing - UAT)

Thực hiện các bước sau trên thiết bị thật hoặc máy ảo để kiểm tra tính năng.

### A. Bảo Mật & Riêng Tư (Phase A)
| # | Tên Test Case | Các bước thực hiện | Kết quả mong đợi |
|---|---|---|---|
| A1 | **Thiết lập PIN** | Vào Cài đặt -> Bảo mật -> Thiết lập mã PIN -> Nhập PIN 4 số. | Thông báo thành công, menu đổi thành "Đổi mã PIN". |
| A2 | **Màn hình khóa** | Thoát app hoặc cho xuống background > 30 giây -> Mở lại app. | App hiện màn hình nhập PIN. Nhập đúng -> vào app. Nhập sai -> báo lỗi. |
| A3 | **Chế độ riêng tư** | Vào Cài đặt -> Bật "Chế độ riêng tư" (Privacy Mode). | Các số tiền trên màn hình chính, danh sách giao dịch đều hiển thị `*****`. |

### B. Sự kiện / Chuyến đi (Phase B)
| # | Tên Test Case | Các bước thực hiện | Kết quả mong đợi |
|---|---|---|---|
| B1 | **Tạo sự kiện** | Trang chủ -> Shortcut "Sự kiện" (màu xanh teal) -> Nhấn (+) -> Nhập tên, ngân sách. | Sự kiện mới xuất hiện trong danh sách. |
| B2 | **Gắn giao dịch** | Tạo giao dịch mới (chi tiêu) -> Chọn "Sự kiện" -> Lưu. | Giao dịch được lưu với sự kiện đã chọn. |
| B3 | **Báo cáo sự kiện** | Vào danh sách sự kiện -> Xem sự kiện vừa tạo. | Thanh tiến độ chi tiêu tăng lên, số tiền "Đã chi" hiển thị đúng tổng giao dịch. |

### C. Ngân sách Thông minh (Phase C)
| # | Tên Test Case | Các bước thực hiện | Kết quả mong đợi |
|---|---|---|---|
| C1 | **Tạo ngân sách** | Tab Ngân sách -> (+) -> Chọn danh mục "Ăn uống", giới hạn 1,000,000đ. | Ngân sách hiển thị 0/1tr. |
| C2 | **Cảnh báo 90%** | Thêm giao dịch chi tiêu "Ăn uống" với số tiền 950,000đ. | Một thông báo (Notification) xuất hiện: "Cảnh báo ngân sách: Ăn uống" (đã chi 95%). |

### D. Đa Tiền Tệ (Phase D)
| # | Tên Test Case | Các bước thực hiện | Kết quả mong đợi |
|---|---|---|---|
| D1 | **Ví ngoại tệ** | Tab Ví -> Sửa ví hiện tại hoặc tạo mới -> Chọn loại tiền tệ (USD). | Số dư ví hiển thị theo ký hiệu USD ($). |
| D2 | **Tổng tài sản** | Trang chủ -> Card Tổng số dư. | (Lưu ý: Phiên bản hiện tại có thể chưa quy đổi tỷ giá realtime, kiểm tra xem tổng số dư có cộng dồn đúng không). |

### E. Tìm kiếm Nâng cao (Phase E)
| # | Tên Test Case | Các bước thực hiện | Kết quả mong đợi |
|---|---|---|---|
| E1 | **Tìm không dấu** | Giao dịch có ghi chú "Ăn trưa". Nhập từ khóa search "an trua". | Kết quả hiển thị giao dịch "Ăn trưa". |
| E2 | **Bộ lọc** | Bấm icon lọc -> Chọn khoảng tiền 50k - 100k -> Áp dụng. | Chỉ hiển thị các giao dịch trong khoảng tiền này. |

### F. Báo cáo Sổ quỹ (Phase F)
| # | Tên Test Case | Các bước thực hiện | Kết quả mong đợi |
|---|---|---|---|
| F1 | **Xem sổ quỹ** | Tab Báo cáo -> Chọn "Sổ quỹ (Cashbook)". | Hiển thị bảng theo dõi dòng tiền hàng ngày: Thu, Chi, Tồn cuối ngày. |
| F2 | **Kiểm tra tồn** | So sánh số dư "Tồn" của ngày cuối cùng với tổng số dư hiện tại. | Phải khớp nhau (nếu filter theo tất cả ví). |

## 3. Troubleshooting

- **Lỗi Database**: Nếu gặp lỗi cấu trúc bảng, hãy thử gỡ cài đặt app và cài lại (để trigger lại migration hoặc tạo mới DB).
- **Lỗi Notification**: Đảm bảo đã cấp quyền thông báo cho ứng dụng trên Android settings.
- **Lỗi font**: Nếu ô vuông hiện ra thay vì chữ, kiểm tra lại font Roboto/Inter trong `pubspec.yaml`.

---
*Generated by Antigravity Assitant*
